<!DOCTYPE html>
<html>
  <head>
    <script type="module" src="./src/components/search-input"></script>
    <script type="module" src="./src/components/virtualized-table"></script>
    <script
      type="module"
      src="./src/components/accessible-modal/accessible-modal.ts"
    ></script>
  </head>
  <body>
    <div
      style="
        padding: 2rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        max-width: 800px;
        margin: 0 auto;
      "
    >
      <search-input
        placeholder="Search users..."
        debounce="1000"
      ></search-input>
      <button class="trigger-button" onclick="openModal('basicModal')">
        Open Basic Modal
      </button>

      <accessible-modal id="basicModal" title="Welcome to Accessible Modal">
      </accessible-modal>
      <virtualized-table height="400"></virtualized-table>
    </div>

    <script>
      const searchInput = document.querySelector("search-input");
      searchInput.suggestions = [
        { id: "1", label: "CJ Doe", value: "john" },
        { id: "2", label: "Dennis Smith", value: "jane" },
        { id: "3", label: "Bob Johnson", value: "bob" },
      ];

      searchInput.addEventListener("search", (event) => {
        console.log("Search:", event.detail.query);
      });

      searchInput.addEventListener("suggestion-selected", (event) => {
        console.log("Selected suggestion:", event.detail.suggestion);
      });

      fetch(
        "https://newsapi.org/v2/everything?q=tech&apiKey=33eb5a6baf50414e8d5f17a3ad4b7ab9"
      )
        .then((response) => response.json())
        .then((data) => {
          const table = document.querySelector("virtualized-table");
          const slicedData = data.articles.slice(0, 100);
          table.data = slicedData;

          table.columns = [
            {
              key: "title",
              header: "Title",
              sortable: true,
            },
            {
              key: "publishedAt",
              header: "Date",
              sortable: true,
              width: 150,
              align: "center",
            },
          ];

          table.addEventListener("row-click", (event) => {
            const row = event.detail;
            const modal = document.getElementById("basicModal");
            modal.title = row.title;
            const paragraphElement = document.createElement("p");
            paragraphElement.textContent = row.description;
            modal.appendChild(paragraphElement);

            modal.open = true;
          });
        })
        .catch((error) => console.error("Error fetching data:", error));

      function openModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.open = true;
      }

      function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.open = false;
      }

      function handleCustomAction() {
        alert("Action confirmed!");
        closeModal("customModal");
      }

      // Listen for modal events
      document.addEventListener("modal-close", (event) => {
        closeModal("basicModal");
      });

      document.addEventListener("modal-confirm", (event) => {
        closeModal("basicModal");
      });

      // Add some focusable elements to test tab navigation
      const demoSection = document.querySelector(".demo-section");
      const testButton = document.createElement("button");
      testButton.textContent = "Test Button (before modal)";
      testButton.className = "trigger-button";
      testButton.style.marginRight = "1rem";
      testButton.onclick = () => openModal("basicModal");
      demoSection?.insertBefore(testButton, demoSection.firstChild);
    </script>
  </body>
</html>
